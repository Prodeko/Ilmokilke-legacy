{% extends 'ProdekoIlmoBundle:Ilmo:base.html.twig' %}

{% block title %}
	{{ parent() }} - {{ event.name }}
{% endblock %}
{% if kiltis %}
	{% set isOpen = event.kiltisIlmoOpen %}
{% else %}
	{% set isOpen = event.isOpen %}
{% endif %}
{% block body %}
	<div class="container-flexible">
		<div id="content">
			<div class="row">
				<div class="span3">
					<h3>{% trans %}header.event.sidebar{% endtrans %}</h3>
					{% if is_granted('ROLE_ADMIN') %}
					<p><a href={{ path('adminRegistrations', {'id': event.id}) }}>{% trans %}view.admin{% endtrans %}</a></p>
					<p><a href={{ path('edit', {'id': event.id}) }}>{% trans %}event.edit{% endtrans %}</a></p>
					{% endif %}
				</div>
				<div class="span9">
					<div class="row">
						<div class="span9">
							<div id="title">
								<h1>{% trans %}ilmokilke{% endtrans %}</h1>
								<p><a href={{ path('list') }}>{% trans %}back.to.list{% endtrans %}</a>
							</div>
			    			<h2 id="eventtitle">{{ event.name }}</h2>
		    			</div>
	    			</div>
	    			<div class="row">
    					<div class="span4">
    						<p id="eventtime">{% trans %}time{% endtrans %}: {{ event.takesPlace | date("j.n.y") }} {% trans %}time.at{% endtrans %} {{ event.takesPlace | date("G:i") }}</p>
    						<p id="eventlocation">{% trans %}location{% endtrans %}: {{ event.location }}</p>
    					</div>
    					<div class="span5">
   							<p id="registrationPeriod">{% trans %}registration.period{% endtrans %}: {{ event.registrationStarts | date("j.n.y G:i") }} - {{ event.registrationEnds | date("j.n.y G:i") }}</p>
    						<p id="registrationOpen">{% if isOpen %}{% trans %}registration.open{% endtrans %}{% else %}{% trans %}registration.not.yet.open{% endtrans %}{% endif %}</p>
    					</div>
	    			</div>
	    			<div class="row">
	    				<div class="span9">
			    			<p id="eventsummary">{{ event.summary }}</p>
			    			{% if isOpen %}
				    			<button id="eventsubscribe" class="btn" data-toggle="modal" href="#subscriptionmodal">{% trans %}register{% endtrans %}</button>
				    			<!-- Start subscription modal -->
				    			{% include 'ProdekoIlmoBundle:Ilmo:registration.html.twig' %}
				    			<!-- End subscription modal -->
			    			{% endif %}
		    			</div>
					</div>
					<div class="row">
		    			<div class="span4" id="eventdescription">
		    				<p>{{ event.description }}</p>
		    				<h3>Vapaita paikkoja:</h3>
		    				<table class="table-condensed">
			    				{% for quota in event.quotas %}
			    				<tr>
			    					{% set progress="progress-success" %}
			    					{% if quota.getFill >= 50 %}
			    						{% set progress = "progress-warning" %}
		    							{% if quota.getFill > 80 %}
		    								{% set progress = "progress-danger" %}
	    								{% endif %}
    								{% elseif quota.getFill == 0 %}
    									{% set progress = "" %}
    								{% endif %}
			    					<td>{{ quota.name }}</td>
			    					<td>{{ quota.getFreeSeats }} / {{ quota.getSize }}</td>
			    					<td><div class="progress {{ progress }}"><div class="bar" style="width: {{100 - quota.getFill }}%"></div></div></td>
		    					</tr>
		    					{% endfor %}
		    					<tr>
		    						<td>{% trans %}quota.open{% endtrans %}</td>
		    						<td>{{ event.getFreeSeatsInOpenQuota }} / {{ event.getSizeOfOpenQuota }}
		    						<td><div class="progress"><div class="bar" style="width: {{100 -  event.getOpenQuotaFill }}%"></div></div></td>
		    					</tr>
		    				</table>
		    				
		    			</div>
		    			<div class="span5" id="registered">
		    				<h3>{% trans %}header.registrant.list{% endtrans %}</h3>
			    			{% for quota in event.quotas %}
					    			<h4>{{ quota.name }}</h4>
					    			
					    			<table class="table table-striped table-bordered table-condensed">
				    					<thead>
				    						<tr>
				    							<th>{% trans %}name.first{% endtrans %}</th>
				    							<th>{% trans %}name.last{% endtrans %}</th>
				    						</tr>
				    					</thead>
					    				<tbody>
								    		{% for registration in quota.getRegistrations %}
									    		{% set dataContent %}
													{% for entry in registration.freeTextEntries %}
														{% if not entry.field.flagPrivate %}
															<p>{{ entry.field.name }}: {{ entry.content }}</p>
														{% endif %}
													{% endfor %}
													{% for entry in registration.multipleChoiceEntries %}
														{% if not entry.field.flagPrivate %}
														<p>{{ entry.field.name }}: {{ entry.selection }}</p>
													{% endif %}
													{% endfor %}
												{% endset %}
												<tr class="registered" data-content="{{ dataContent|e }}">
													<td>{{ registration.firstName }}</td>
													<td>{{ registration.lastName }}</td>
												</tr>
											{% endfor %}
										</tbody>
									</table>
							{% endfor %}
								<h4>{% trans %}quota.open{% endtrans %}</h4>
								<table class="table table-striped table-bordered table-condensed">
									<thead>
										<tr>
											<th>{% trans %}name.first{% endtrans %}</th>
				    						<th>{% trans %}name.last{% endtrans %}</th>
										</tr>
									</thead>
									<tbody>
										{% for registration in event.getOpenQuotaRegistrations %}
											{% set dataContent %}
													{% for entry in registration.freeTextEntries %}
														{% if not entry.field.flagPrivate %}
															<p>{{ entry.field.name }}: {{ entry.content }}</p>
														{% endif %}
													{% endfor %}
													{% for entry in registration.multipleChoiceEntries %}
														{% if not entry.field.flagPrivate %}
														<p>{{ entry.field.name }}: {{ entry.selection }}</p>
													{% endif %}
													{% endfor %}
												{% endset %}
												<tr class="registered" data-content="{{ dataContent|e }}">
													<td>{{ registration.firstName }}</td>
													<td>{{ registration.lastName }}</td>
												</tr>
										{% endfor %}
									</tbody>
								</table>
							<h3>{% trans %}queue{% endtrans %}</h3>
							<table class="table table-striped table-bordered table-condensed">
								<thead>
									<tr>
										<th>{% trans %}name{% endtrans %}</th>
										<th>{% trans %}time{% endtrans %}</th>
									</tr>
								</thead>
								<tbody>
								{% for registration in queue %}
									{% set dataContent %}
										{% for entry in registration.freeTextEntries %}
											{% if not entry.field.flagPrivate %}
												<p>{{ entry.field.name }}: {{ entry.content }}</p>
											{% endif %}
								{% endfor %}
								{% for entry in registration.multipleChoiceEntries %}
									{% if not entry.field.flagPrivate %}
										<p>{{ entry.field.name }}: {{ entry.selection }}</p>
									{% endif %}
								{% endfor %}
									{% endset %}
									<tr class="registered" data-content="{{ dataContent|e }}">
										<td>{{ registration.firstName }} {{ registration.lastName }}</td>
										<td>{{ registration.registrationTime|date("d.m.y h.i.s") }}
									</tr>
								{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
    		</div>
    	</div>
    	{% include 'ProdekoIlmoBundle:Ilmo:footer.html.twig' %}
    </div>
{% endblock %}

{% block javascripts %}
	<script src="{{ asset('js/event.js') }}"></script>
{% endblock %}
