{% extends 'ProdekoIlmoBundle:Ilmo:base.html.twig' %}

{% block title %}
	{{ parent() }} - {{ event.name }}
{% endblock %}
{% if kiltis %}
	{% set isOpen = event.kiltisIlmoOpen %}
{% else %}
	{% set isOpen = event.isOpen %}
{% endif %}
{% block body %}
	<div class="container" id="content">
		<div class="row">
			<div class="span6" id="title">
				{% if is_granted('ROLE_ADMIN') %}
					<p><a href={{ path('adminRegistrations', {'id': event.id}) }}>{% trans %}view.admin{% endtrans %}</a></p>
					<p><a href={{ path('edit', {'id': event.id}) }}>{% trans %}event.edit{% endtrans %}</a></p>
				{% endif %}
				<h1 id="eventtitle">{{ event.name }}</h1>
				<p><a href={{ path('list') }}>{% trans %}back.to.list{% endtrans %}</a></p>
			</div>
				
			<div class="span3">
				<button id="eventsubscribe" class="btn-large btn-success" data-toggle="modal" href="#subscriptionmodal">{% trans %}register{% endtrans %}</button>
			</div>
    	</div>
	    		
	    <div class="row">
    		<div class="span6">
    			<p id="eventtime">{% trans %}time{% endtrans %}: {{ event.takesPlace | date("j.n.y") }} {% trans %}time.at{% endtrans %} {{ event.takesPlace | date("G:i") }}</p>
    			<p id="eventlocation">{% trans %}location{% endtrans %}: {{ event.location }}</p>

   				<p id="registrationPeriod">{% trans %}registration.period{% endtrans %}: {{ event.registrationStarts | date("j.n.y G:i") }} - {{ event.registrationEnds | date("j.n.y G:i") }}</p>
    			<p id="registrationOpen">{% if isOpen %}{% trans %}registration.open{% endtrans %}{% else %}{% trans %}registration.not.yet.open{% endtrans %}{% endif %}</p>
    		
    			<p id="eventsummary">{{ event.summary }}</p>
	    		{% if isOpen %}
		   		<!-- Start subscription modal -->
		    		{% include 'ProdekoIlmoBundle:Ilmo:registration.html.twig' %}
		    		<!-- End subscription modal -->
	    		{% endif %}
	    	
	    		<p>{{ event.description | nl2br }}</p>
    		
	    	</div>
	    	<div class="span6">
	    		<h3>Vapaita paikkoja:</h3>
    			<table class="table-condensed">
	    			{% for quota in event.quotas %}
	    			<tr>
	    				{% set progress="progress-success" %}
	    				{% if quota.getFill >= 50 %}
	    					{% set progress = "progress-warning" %}
    						{% if quota.getFill > 80 %}
    							{% set progress = "progress-danger" %}
    							{% endif %}
    							{% elseif quota.getFill == 0 %}
    								{% set progress = "" %}
    							{% endif %}
	    				<td>{{ quota.name }}</td>
	    				<td>{{ quota.getFreeSeats }} / {{ quota.getSize }}</td>
	    				<td><div class="progress {{ progress }}"><div class="bar" style="width: {{100 - quota.getFill }}%"></div></div></td>
    				</tr>
    				{% endfor %}
    				<tr>
    					<td>{% trans %}quota.open{% endtrans %}</td>
    					<td>{{ event.getFreeSeatsInOpenQuota }} / {{ event.getSizeOfOpenQuota }}
    					<td><div class="progress"><div class="bar" style="width: {{100 -  event.getOpenQuotaFill }}%"></div></div></td>
    				</tr>
    			</table>
    				{% for quota in event.quotas %}
			    	<h4>{{ quota.name }}</h4>
			    	<table class="table table-striped table-bordered table-condensed">
		    			<thead>
		    				<tr>
		    					<th>{% trans %}name.first{% endtrans %}</th>
		    					<th>{% trans %}name.last{% endtrans %}</th>
		    				</tr>
		    			</thead>
			    		<tbody>
						    {% for registration in quota.getRegistrations %}
							    {% set dataContent %}
									{% for entry in registration.freeTextEntries %}
										{% if not entry.field.flagPrivate %}
											<p>{{ entry.field.name }}: {{ entry.content }}</p>
										{% endif %}
									{% endfor %} 
									{% for entry in registration.multipleChoiceEntries %}
										{% if not entry.field.flagPrivate %}
										<p>{{ entry.field.name }}: {{ entry.selection }}</p>
										{% endif %}
									{% endfor %}
								{% endset %}
								<tr class="registered" data-content="{{ dataContent|e }}">
									<td>{{ registration.firstName }}</td>
									<td>{{ registration.lastName }}</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				{% endfor %}
	    	</div>
	    </div>
			
    	</div>

{% endblock %}

{% block javascripts %}
	<script src="{{ asset('js/event.js') }}"></script>
{% endblock %}
